# Happy Coon Coffee tables reservation service

Этот проект является микросервисом для бронирования столов в кафе, разработанным на FastAPI. В проекте предусмотрено использование базы данных PostgreSQL, используется SQLAlchemy, alembic, asyncpg. 

## Требования

- Python 3.9+
- FastAPI
- SQLAlchemy
- Alembic
- PostgreSQL

## Установка

1. Клонируйте репозиторий:

```bash
git clone [https://github.com/ваш-пользователь/ваш-репозиторий.git](https://github.com/kabzal/booking_fastapi.git)
cd booking_fastapi
```

2. Создайте виртуальное окружение и активируйте его:
``bash
python -m venv venv
source venv/bin/activate  # Для Windows: venv\Scripts\activate
```

3. Установите необходимые зависимости:
```bash
pip install -r requirements.txt
```

## Настройка
Создайте файл ```.env``` в корне проекта, скопировав содержимое из ```.env.example``` и заполнив его вашими данными:
```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=your_bookings_db
DB_USER=your_bookings_user
DB_PASS=your_bookings_password

ADMIN_NAME=admin
ADMIN_EMAIL=admin@admin.com
ADMIN_PASS=admin

SECRET_KEY=your_secret_key
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

Настройте базу данных и примените миграции:
```bash
alembic upgrade head
```

## Запуск
Запустите приложение:

```bash
uvicorn main:app --reload
```

## Использование
После запуска сервер будет доступен по адресу ```http://127.0.0.1:8000```. Рекомендуется тестировать функционал через ```http://127.0.0.1:8000/docs```.

## API Эндпоинты
# Auth
- POST /auth/token
  - Получение токена доступа
  - Параметры: username, password

# Users
- POST /users/register
  - Регистрация нового пользователя
  - Параметры: user: schemas.UserCreate

- GET /users/me
  - Получение информации о текущем пользователе

# Bookings
- POST /bookings/create
  - Создание бронирования
  - Параметры: start_time, end_time, table_type
  - Ограничения:
    - можно бронировать столы с 9 утра до 9 вечера любого дня;
    - бронь минимум на 1 час, максимум на 4 часа;
    - бронировать можно только ровно в определенные часы (например, в 14:00, 15:00 - в противовес 14:30, 15:15 и т.д.);
    - должны быть свободны столы указанного типа на указанный период времени.

- GET /bookings/my_bookings
  - Получение всех бронирований текущего пользователя

- GET /bookings/my_upcoming_bookings
  - Получение всех будущих бронирований текущего пользователя

- GET /bookings/my_previous_bookings
  - Получение всех предыдущих бронирований текущего пользователя

- GET /bookings/get_all_bookings
  - Получение всех бронирований (только для администратора)

- DELETE /bookings/delete_booking/{booking_id}
  - Удаление бронирования (пользователь может удалить свои будущие бронирования, администратор может удалить любые бронирования)

# Tables
- POST /tables/add_table
  - Добавление нового стола (только для администратора)
  - Параметры: table: schemas.TableCreate

- GET /tables/
  - Получение списка всех столов

- DELETE /tables/delete_table/{table_id}
  - Удаление стола (только для администратора)

## Рекомендации по первому использованию
При первом запуске приложения у Вас, вероятно, будет пустая база данных. 
Рекомендуется в первую очередь создать пользователя с правами администратора: для этого зарегистрируйте нового пользователя 
через ```POST /users/register``` с ```username```, ```email``` и ```password```, соответствующие переменным соответственно ```ADMIN_NAME```, ```ADMIN_EMAIL```, ```ADMIN_PASS``` в файле ```.env```.

Далее авторизуйтесь в качестве этого пользователя через кнопку ```Authorize``` на странице ```http://127.0.0.1:8000/docs```, после чего добавьте в базу данных необходимое количество столов нужных Вам типов.

После этих действий Вы можете создавать новых пользователей и бронировать столы / отменять брони.

## Дальнейшие доработки
В скором времени планируется ряд доработок:
- Подготовка файлов Dockerfile и docker-compose.yml для запуска приложения и базы данных с помощью контейнеров (Docker)
- исправление полей ввода даты и времени брони для удобного ввода даты и времени (НЕ в формате ```2024-07-08T13:20:41.391Z```)
- Оптимизация текущих функций, добавление документации в функции.
